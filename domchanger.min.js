("object"==typeof module&&"object"==typeof module.exports&&function(e){module.exports=e()}||"function"==typeof define&&function(e){define("domchanger",e)}||function(e){window.domChanger=e()})(function(){"use strict";function e(n,o,i){function l(){k.parentNode.appendChild(k),Object.keys(E).forEach(function(e){var t=E[e];t.el?o.appendChild(t.el):t.append&&t.append()})}function c(){k.parentNode.removeChild(k),k=null,f(E),delete O.update,delete O.destroy,delete O.handleEvent,C()}function f(e){Object.keys(e).forEach(function(t){var n=e[t];n.el?n.el.parentNode.removeChild(n.el):n.destroy&&n.destroy(),delete e[t],n.children&&f(n.children)})}function u(){if(j){var e=t(j.apply(null,b));p(o,e,E)}}function s(e){e.destroy?e.destroy():e.el.parentNode.removeChild(e.el)}function p(t,n,o){Object.keys(o).forEach(function(e){if(!n[e]){var t=o[e];s(t),delete o[e]}});var i=Object.keys(o),l=Object.keys(n);l.forEach(function(l,a){var c=o[l],f=n[l],u=i.indexOf(l);if(void 0!==f.text)c?f.text!==c.text&&(c.el.nodeValue=c.text=f.text):(c=o[l]={text:f.text,el:document.createTextNode(f.text)},t.appendChild(c.el));else if(f.tagName)c||(c=o[l]={tagName:f.tagName,el:document.createElement(f.tagName),children:{}},f.ref&&(c.ref=f.ref,y[c.ref]=c.el),t.appendChild(c.el)),c.props||(c.props={}),r(c.el,f.props,c.props),f.children&&p(c.el,f.children,c.children);else if(f.component)c||(c=o[l]=e(f.component,t,O),c.append()),c.update.apply(null,f.data);else{if(!f.el)throw console.error(f),new Error("This shouldn't happen");c&&(c=s(c)),c=o[l]={el:f.el},t.appendChild(c.el)}u>=0&&a>u&&t.appendChild(o[l].el)})}function m(){b=d.call(arguments),u()}function v(){if(!i)throw new Error("Can't emit events from top-level component");i.handleEvent.apply(null,arguments)}function h(e){var t=x[e];if(!t){if(i)return i.handleEvent.apply(null,arguments);throw new Error("Missing event handler for "+e)}t.apply(null,d.call(arguments,1))}var y={},b=[],E={},g=n(v,u,y),j=g.render,x=g.on||{},C=g.cleanup||a,O={update:m,destroy:c,append:l,handleEvent:h},k=document.createComment(n.name);return o.appendChild(k),O}function t(e){function t(e,r){var o,i,a;if("number"==typeof r&&(r=String(r)),"string"==typeof r)o="text";else if(Array.isArray(r)){if(!r.length)return;if(i=r[0],"function"==typeof i)o="component";else{if("string"!=typeof i)return void r.forEach(function(n){t(e,n)});a=n(r),o="element"}}else{if(!(r instanceof HTMLElement))throw console.error(r),new TypeError("Invalid item");o="el"}for(var c,f=0,u="element"===o?a.ref||a.name:"component"===o?r.key||r[0].name:o;e[c=u+"-"+f++];);var s;if("text"===o)return void(e[c]={text:r});if("el"===o)return void(e[c]={el:r});if("element"===o){var d={};return s=e[c]={tagName:a.name},l(a.props)||(s.props=a.props),a.ref&&(s.ref=a.ref),a.body.forEach(function(e){t(d,e)}),void(l(d)||(s.children=d))}if("component"===o)return void(e[c]={component:r[0],data:r.slice(1)});throw new TypeError("Invalid type")}var r={};return t(r,e),r}function n(e){var t,n={};if(e[1]&&e[1].constructor===Object){for(var r=Object.keys(e[1]),o=0,l=r.length;l>o;o++){var a=r[o];n[a]=e[1][a]}t=e.slice(2)}else t=e.slice(1);var d=e[0],p=d.match(s),m={name:p?p[0]:"div",props:n,body:t},v=d.match(c);v&&(v=v.map(i).join(" "),n.class?n.class+=" "+v:n.class=v);var h=d.match(f);h&&(n.id=i(h[0]));var y=d.match(u);return y&&(m.ref=i(y[0])),m}function r(e,t,n){Object.keys(n).forEach(function(r){if(!t||!t[r]){if("on"===r.substr(0,2)){var o=r.substring(2);e.removeEventListener(o,n[r])}else e.removeAttribute(r);n[r]=null}}),t&&Object.keys(t).forEach(function(r){var i=t[r],l=n[r];if("style"===r&&"object"==typeof i)"string"==typeof l&&e.removeAttribute("style"),l&&"object"==typeof l||(l=n.style={}),o(e.style,i,l);else{if(l===i)return;if("on"===r.substr(0,2)){var a=r.substring(2);l&&e.removeEventListener(a,l),e.addEventListener(a,i),n[r]=i}else"boolean"==typeof i?i?e.setAttribute(r,r):e.removeAttribute(r):"value"===r&&"INPUT"===e.nodeName?e.value=i:e.setAttribute(r,i),n[r]=i}})}function o(e,t,n){Object.keys(n).forEach(function(r){t&&t[r]||(n[r]=e[r]="")}),t&&Object.keys(t).forEach(function(r){var o=t[r],i=n[r];i!==o&&(n[r]=e[r]=t[r])})}function i(e){return e.substring(1)}function l(e){return!Object.keys(e).length}function a(){}var c=/\.[^.#$]+/g,f=/#[^.#$]+/,u=/\$[^.#$]+/,s=/^[^.#$]+/,d=[].slice;return e});